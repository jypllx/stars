{% extends "bo/_base.html" %}

{% block content %}

<h1>Episodes</h1>

<form method="post">
    <div class="row">
        <div class="col-xs-3">
            <div class="form-group">
                <label for="search_title">Titre</label>
                <input type="text" class="form-control" name="search_title" placeholder="Rechercher..." value="{{search_title}}">
            </div>
            <div class="form-group">
                <label for="search_desc">Description</label>
                <input type="text" class="form-control" name="search_desc" placeholder="Rechercher..." value="{{search_desc}}">
            </div>
        </div>
        <div class="col-xs-3">
            <div class="form-group">
                <label for="search_iCat">Genre</label>
                <select class="form-control" name="search_iCat">
                    <option value="">iTunes Category</option>
                    {% for iCat in iTunes_categories %}
                    <option value="{{iCat}}" {% if search_iCat == iCat %} selected="selected" {% endif %}>{{iCat}}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="search_mood">Mood</label>
                <select class="form-control" name="search_mood">
                    <option value="" >Choose Mood</option>
                    {% for mood in moods %}
                    <option value="{{mood}}" {% if search_mood == mood %} selected="selected" {% endif %}>{{mood}}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="col-xs-3">
            <div class="form-group">
                <label for="search_length">Durée</label>
                <select class="form-control" name="search_length">
                    <option value="" >Durée</option>
                    {% for category in time_categories %}
                    <option value="{{category['id']}}" {% if search_length|int() == category['id']|int() %} selected="selected" {% endif %}>{{category.name}}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="search_date">Publié après le</label>
                <input id='search_date' type='text' name="search_date" class="form-control" value="{{search_date}}" placeholder='YYYY-MM-DD'/>
            </div>
        </div>
        <div class="col-xs-3">
            <div class="form-group">
                <label for="search_source">Source</label>
                <select class="form-control" name="search_source">
                    <option value="" >Source</option>
                    {% for source in sources %}
                    <option value="{{source}}" {% if source == search_source %} selected="selected" {% endif %}>{{source}}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="search_country">Country</label>
                <select class="form-control" name="search_country">
                    <option value="" >Country</option>
                    {% for country in countries %}
                    <option value="{{country}}" {% if country == search_country %} selected="selected" {% endif %}>{{country}}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <br/>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <button type="submit" class="btn btn-default">Submit</button>
        </div>
    </div>
</form>
<br/>
<div>
    <div><h3>Dernier ajout : {{last_add}}</h3></div>
    <table class="table table-striped table-hover">
        <tr>
            <th>Titre Tootak</th>
            <th>Mood Tootak</th>
            <th>Description Tootak</th>
            <th>Durée*</th>
            <th>Cat durée*</th>
            <th>Cat iTunes*</th>
            <th>Publié le*</th>
            <th>Audio</th>
            <th>Source</th>
            <th>Country</th>
            <th></th>
        </tr>
        {% for item in items %}
        <tr id="{{item.id}}">
            <td>{{item.title}}</td>
            <td>{{item.mood}}</td>
            <td>{{item.description}}</td>
            <td>{{item.duration_|duration}}</td>
            <td>{{item.cat_name}}</td>
            <td>{{item.itunes_category_}}</td>
            <td>{{item.pubdate_}}</td>
            <td><audio controls>
                <source src="{{item.audio_url_}}" type="audio/mpeg">
                    Your browser does not support the audio element.
                </audio>
            </td>
            <td>{{item.source}}</td>
            <td>{{item.country}}</td>
            <td><div class="dropdown">
                <button class="btn" data-toggle="dropdown"><i class="fa fa-plus"></i>&nbsp;Add to playlist</span></button>
                <ul class="dropdown-menu">
                    {% for playlist in playlists %}
                    <li><a class="add_to_playlist" id="{{playlist.id}}.{{item.id}}" href="#">{{playlist.name}}</a></li>
                    {% endfor %}
                </ul>
            </div>
            <a href='{{ url_for('items_edit', id=item.id) }}' class='btn btn-default'><i class='fa fa-pencil'></i></a>
        </td>
    </tr>            
    {% endfor %}
</table>
</div>
{% endblock %}
{% block js %}
<script type="text/javascript">
    $(document).ready(function(){
        $(".add_to_playlist").click(function(){
            var ids = $(this).attr('id').split(".")
            $.post('{{ url_for('add_item_to_playlist') }}',
            {
                playlist_id:ids[0], item_id:ids[1]
            });
        });
    });
</script>
{% endblock %}