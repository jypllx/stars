{% extends "mobile/_base_mobile.html" %}

{% block content %}
<div class="row">
    <h3><p class="text-center">Tootak</p></h3>
</div>
<div class="row">
    <p class="text-center"><b>Dur√©e</b></p>
</div>
<div class="row time-filter">
    {% for category in time_categories %}
    <div class="col-xs-3"><button class="btn btn-block btn-default btn-time" value="{{category.id}}" id="time{{category.id}}"><i class="fa {{category.icon}}"></i>&nbsp;{{category.name}}</button></div>
    {% endfor %}
</div>
<br/>
<div class="row">
    <p class="text-center"><b>Mood</b></p>
</div>
<div class="row">
    <div class="col-xs-3"><button class="btn btn-default btn-block btn-itunes-cat" id="News">News</button></div>
    <div class="col-xs-3"><button class="btn btn-default btn-block btn-itunes-cat" id="Comedy">Fun</button></div>
    <div class="col-xs-3"><button class="btn btn-default btn-block btn-itunes-cat" id="Culture">Culture</button></div>
    <div class="col-xs-3"><button class="btn btn-default btn-block btn-itunes-cat" id="Sports">Sport</button></div>
</div>
<div class="row" id="item">
    <div class="col-xs-2">
        <button class="genre btn btn-default btn-block"><i class="fa fa-play fa-2x"></i></button>
    </div>
    <div class="col-xs-6">
        <p class="item_name"></p>
        <p class="item_description"></p>
        <p><i class="item_duration"></i></p>
    </div>
    <div class="col-xs-2">
        <button class="btn btn-default btn-block"  id="next" value="" title="Suivant">
            <p class="text-center"><i class="fa fa-forward fa-2x"></i></p>
        </button>
    </div>
    <div class="col-xs-2">
        <button class="btn btn-default btn-block" id="see_all" title="Voir tout">
            <p class="text-center"><i class="fa fa-search fa-2x"></i></p>
        </button>
    </div>
</div>
<br/>
<div class="row">
    <p class="text-center"><b>Autres&nbsp;sujets</b></p>
</div>
<div class="row">
    {% for playlist in playlists %}
    <div class="col-xs-3"><button class="btn btn-default btn-block btn-playlist box" id="{{ playlist.id }}">{{ playlist.name }}</button></div>
    {% endfor %}
</div>
<div class="row" id="playlist" style="display:none">
    <div class="col-xs-3">
        <button class="genre btn btn-default btn-block"><i class="fa fa-play fa-2x"></i></button>
    </div>
    <div class="col-xs-9">
        <p class="item_name"></p>
        <p class="item_description"></p>
        <p><i class="item_duration"></i></p>
    </div>
</div>
</div>

<div style="display:none">
    <form method="post" action="{{url_for('mob_search')}}" id="search_form">
        <input id="cat_time" type="hidden" name="cat_time" value="">
        <input id="itunes_category" type="hidden" name="itunes_category" value="">
        <input id="playlist_id" type="hidden" name="playlist_id" value="">
        <input id="channel_id" type="hidden" name="channel_id" value="">
        <input id="search" type="hidden" name="search" value="">
    </form>
</div>


{% endblock %}
{% block js %}
<script type="text/javascript">
    var genre = {'News & Politics': 'News',
    'Comedy':'Comedy',
}
$(document).ready(function(){
    get_cat_time = function() {
        var cat_time = $(".btn-time.active").attr("value");
        if (cat_time == undefined) {
            cat_time = '';
        }
        return cat_time;
    }
    get_itunes_category = function() {
        var genre = $(".btn-itunes-cat.active").attr("id");
        return genre
    }

    filter = function(cat_time, itunes_cat, page) {
        $.post('{{ url_for('mob_home_ajax') }}',
        {
            cat_time:cat_time, itunes_cat:itunes_cat, page:page
        },
        function(data) {
            $('#playlist').css('display', 'none')
            $('#item').removeAttr('style')
            obj = JSON.parse(data)
            $('#item .item_name').text(obj.item.name)
            $('#item .item_description').text(obj.item.description)
            $('#item .item_duration').text(obj.item.duration)
            $(".btn-itunes-cat.active, .btn-time.active").removeClass('active')
            $('#'+obj.itunes_category_).addClass('active')
            if (obj.cat_time != '') {
                $('#time'+obj.cat_time).addClass('active')
            }
            $("#next").attr("value", +obj.page+1)
            $("#next").removeClass('active')
            $("#next").blur()
        });
    }


    $(".btn-time").click(function(){
        cat_time = $(this).attr("value")
        filter(cat_time, get_itunes_category(), 0);
    });
    $(".btn-itunes-cat").click(function(){
        genre = $(this).attr("id")
        filter(get_cat_time(), genre, 0);
    });
    $("#next").click(function() {
        page = $(this).attr("value")
        filter(get_cat_time(), get_itunes_category(), page)
    });

    $("#see_all").click(function() {
        $('#cat_time').attr('value', get_cat_time())
        $('#itunes_category_').attr('value', get_itunes_category())
        $('#search_form').submit();
    });

    getPlaylist = function(playlistId) {
        $.post('{{ url_for('mob_playlist_ajax')}}',
        {
            playlistId:playlistId
        },
        function(data) {
            obj = JSON.parse(data)
            $('#filter').css('display', 'none')
            $('#playlist').removeAttr('style')
            $('#playlist .item_name').text(obj.item.name)
            $('#playlist .item_description').text(obj.item.description)
            $('#playlist .item_duration').text(obj.item.duration)
            $(".btn-itunes-cat.active, .btn-time.active").removeClass('active')
            $('#'+obj.genre).addClass('active')
            if (obj.playlistId != '') {
                $('#'+obj.cat_time).addClass('active')
            }
        });
    }

    $(".btn-playlist").click(function() {
        $('#playlist_id').attr("value", $(this).attr("id"));
        $('#search_form').submit();
    });

    filter('', 'News', 0)
});
</script>
{% endblock %}